openapi: 3.1.0
info:
  title: Aegis REST-API
  description: A simple web console and REST API for Aegis.
  version: v1
paths:
  /:
    get:
      summary: Home
      operationId: home__get
      responses:
        '200':
          description: Successful Response
          content:
            text/html:
              schema:
                type: string
  /api/v1/analysis/cve:
    get:
      summary: Cve Analysis
      operationId: cve_analysis_api_v1_analysis_cve_get
      parameters:
      - name: feature
        in: query
        required: true
        schema:
          $ref: '#/components/schemas/aegis_ai_web__src__main__ComponentFeatureName__1'
      - name: cve_id
        in: query
        required: true
        schema:
          type: string
          pattern: ^CVE-[0-9]{4}-[0-9]{4,7}$
          title: Cve Id
      - name: detail
        in: query
        required: false
        schema:
          type: boolean
          default: false
          title: Detail
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /api/v1/analysis/cve/{feature}:
    post:
      summary: Cve Analysis With Body
      operationId: cve_analysis_with_body_api_v1_analysis_cve__feature__post
      parameters:
      - name: feature
        in: path
        required: true
        schema:
          $ref: '#/components/schemas/aegis_ai_web__src__main__ComponentFeatureName__1'
      - name: detail
        in: query
        required: false
        schema:
          type: boolean
          default: false
          title: Detail
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /api/v1/analysis/component:
    get:
      summary: Component Analysis
      operationId: component_analysis_api_v1_analysis_component_get
      parameters:
      - name: feature
        in: query
        required: true
        schema:
          $ref: '#/components/schemas/aegis_ai_web__src__main__ComponentFeatureName'
      - name: component_name
        in: query
        required: true
        schema:
          type: string
          title: Component Name
      - name: detail
        in: query
        required: false
        schema:
          type: boolean
          default: false
          title: Detail
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
  /api/v1/analysis/kpi/cve:
    get:
      summary: Get CVE Analysis KPI Metrics
      description: Retrieve Key Performance Indicator (KPI) metrics for CVE analysis
        feedback, filtered by feature name. Returns the acceptance score percentage
        and all matching log entries sorted by datetime. Use feature='all' to get KPIs for all features.
      operationId: cve_kpi_api_v1_analysis_kpi_cve_get
      parameters:
      - name: feature
        in: query
        required: true
        schema:
          type: string
          description: 'Feature name to filter entries by. Valid values include: ''suggest-impact'',
            ''suggest-cwe'', ''suggest-description'', ''suggest-statement'', ''identify-pii'',
            ''cvss-diff-explainer'', or ''all'' to get KPIs for all features.'
          examples:
          - suggest-impact
          - suggest-cwe
          - suggest-description
          - all
          title: Feature
        description: 'Feature name to filter entries by. Valid values include: ''suggest-impact'',
          ''suggest-cwe'', ''suggest-description'', ''suggest-statement'', ''identify-pii'',
          ''cvss-diff-explainer'', or ''all'' to get KPIs for all features.'
      - name: order
        in: query
        required: false
        schema:
          $ref: '#/components/schemas/SortOrder'
          description: Sort order for datetime field. Must be 'asc' (ascending, oldest
            first) or 'desc' (descending, newest first). Defaults to 'asc'.
          examples:
          - asc
          - desc
          default: asc
        description: Sort order for datetime field. Must be 'asc' (ascending, oldest
          first) or 'desc' (descending, newest first). Defaults to 'asc'.
      responses:
        '200':
          description: Successful response with KPI metrics. When feature='all', returns
            a JSON object with each feature name as a key and its FeatureKPI as the value.
          content:
            application/json:
              schema:
                oneOf:
                - $ref: '#/components/schemas/FeatureKPI'
                - type: object
                  additionalProperties:
                    $ref: '#/components/schemas/FeatureKPI'
                  description: Response when feature='all'. Keys are feature names, values
                    are FeatureKPI objects.
              examples:
                all_features:
                  summary: Response when feature='all'
                  value:
                    suggest-impact:
                      acceptance_percentage: 75.0
                      entries:
                      - datetime: '2025-01-15 10:30:45.123'
                        accepted: true
                        aegis_version: 1.0.0
                    suggest-cwe:
                      acceptance_percentage: 80.0
                      entries:
                      - datetime: '2025-01-15 11:00:00.456'
                        accepted: true
                        aegis_version: 1.0.0
                with_entries:
                  summary: Response with multiple entries
                  value:
                    acceptance_percentage: 75.0
                    entries:
                    - datetime: '2025-01-15 10:30:45.123'
                      accepted: true
                      aegis_version: 1.0.0
                    - datetime: '2025-01-15 11:00:00.456'
                      accepted: true
                      aegis_version: 1.0.0
                    - datetime: '2025-01-15 11:30:15.789'
                      accepted: false
                      aegis_version: 1.0.0
                    - datetime: '2025-01-15 12:00:30.012'
                      accepted: true
                      aegis_version: 1.0.0
                empty_response:
                  summary: Response when no entries exist for feature
                  value:
                    acceptance_percentage: 0.0
                    entries: []
        '422':
          description: Validation error - invalid order parameter or missing feature
          content:
            application/json:
              example:
                detail:
                - type: missing
                  loc:
                  - query
                  - feature
                  msg: Field required
        '500':
          description: Internal server error
          content:
            application/json:
              example:
                detail: 'Error retrieving KPI data for feature ''suggest-impact'':
                  <error message>'
  /api/v1/feedback:
    post:
      summary: Save Feedback
      description: 'Receive feedback and log it to CSV file.


        All data is preserved without modification. CSV library handles escaping.'
      operationId: save_feedback_api_v1_feedback_post
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Feedback'
        required: true
      responses:
        '200':
          description: Successful Response
          content:
            application/json:
              schema: {}
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
components:
  schemas:
    Feedback:
      properties:
        feature:
          type: string
          maxLength: 100
          title: Feature
        cve_id:
          anyOf:
          - type: string
            maxLength: 50
            pattern: ^CVE-[0-9]{4}-[0-9]{4,7}$
          - type: 'null'
          title: Cve Id
          default: ''
        email:
          anyOf:
          - type: string
            maxLength: 100
          - type: 'null'
          title: Email
          default: ''
        request_time:
          anyOf:
          - type: string
            maxLength: 50
          - type: 'null'
          title: Request Time
          default: ''
        actual:
          anyOf:
          - type: string
            maxLength: 5000
          - type: 'null'
          title: Actual
          default: ''
        expected:
          anyOf:
          - type: string
            maxLength: 5000
          - type: 'null'
          title: Expected
          default: ''
        accept:
          type: boolean
          title: Accept
          default: false
        rejection_comment:
          anyOf:
          - type: string
            maxLength: 5000
          - type: 'null'
          title: Rejection Comment
          default: ''
      type: object
      required:
      - feature
      title: Feedback
      description: 'Data structure for feedback.


        All fields are stored without modification to preserve original data.

        CSV escaping is handled automatically by the csv library during logging.'
    HTTPValidationError:
      properties:
        detail:
          items:
            $ref: '#/components/schemas/ValidationError'
          type: array
          title: Detail
      type: object
      title: HTTPValidationError
    KPIEntry:
      properties:
        datetime:
          type: string
          title: Datetime
          description: Timestamp of the feedback entry
        accepted:
          type: boolean
          title: Accepted
          description: Whether the feedback was accepted
        aegis_version:
          type: string
          title: Aegis Version
          description: AEGIS version at time of feedback
      type: object
      required:
      - datetime
      - accepted
      - aegis_version
      title: KPIEntry
      description: 'Individual KPI entry model.


        Contains datetime, acceptance status, and AEGIS version for a feedback entry.'
    FeatureKPI:
      properties:
        acceptance_percentage:
          type: number
          title: Acceptance Percentage
          description: Acceptance score as a percentage (0.0 to 100.0, e.g., 75.0 for 75%)
        entries:
          items:
            $ref: '#/components/schemas/KPIEntry'
          type: array
          title: Entries
          description: List of log entries filtered by feature, sorted by datetime
      type: object
      required:
      - acceptance_percentage
      - entries
      title: FeatureKPI
      description: 'Feature KPI model for CVE analysis feedback.


        Contains the acceptance score percentage and filtered log entries.'
    SortOrder:
      type: string
      enum:
      - asc
      - desc
      title: SortOrder
      description: Sort order for datetime field.
    ValidationError:
      properties:
        loc:
          items:
            anyOf:
            - type: string
            - type: integer
          type: array
          title: Location
        msg:
          type: string
          title: Message
        type:
          type: string
          title: Error Type
      type: object
      required:
      - loc
      - msg
      - type
      title: ValidationError
    aegis_ai_web__src__main__ComponentFeatureName:
      type: string
      enum:
      - component-intelligence
      title: ComponentFeatureName
    aegis_ai_web__src__main__ComponentFeatureName__1:
      type: string
      enum:
      - suggest-impact
      - suggest-cwe
      - suggest-description
      - suggest-statement
      - identify-pii
      - cvss-diff-explainer
      title: ComponentFeatureName
